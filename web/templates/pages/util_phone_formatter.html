{{define "content"}}
    {{template "util_layout" .}}
{{end}}

{{define "util_body"}}
    <div class="side-action-btn hidden md:block w-24"></div>

    <div id="contact-deck" class="w-full max-w-md px-4">
        <div class="card bg-base-300 mb-6 shadow-inner border border-base-100/10">
            <div class="card-body p-4 flex-row items-center gap-4">
                <span class="text-[10px] font-bold uppercase opacity-60">Format:</span>
                <select id="format-selector" class="select select-bordered select-sm flex-1 font-mono focus:ring-2 focus:ring-primary" onchange="window.previewPhone()">
                    <option value="(XXX) XXX-XXXX">(123) 456-7890</option>
                    <option value="XXX-XXX-XXXX">123-456-7890</option>
                    <option value="XXX.XXX.XXXX">123.456.7890</option>
                    <option value="+1 XXXXXXXXXX">+1 1234567890</option>
                    <option value="+1 (XXX) XXX-XXXX">+1 (123) 456-7890</option>
                </select>
            </div>
        </div>

        {{if .Items}}
            {{range $contactIndex, $c := .Items}}
                {{range $phoneIndex, $p := $c.Phones}}
                <div class="util-card {{if or (ne $contactIndex 0) (ne $phoneIndex 0)}}hidden{{end}} card bg-base-100 shadow-xl border border-base-300 mx-auto"
                     data-id="{{$c.ID}}" 
                     data-phone-id="{{$p.ID}}"
                     data-raw="{{$p.Phone}}">
                    
                    <div class="card-body items-center text-center">
                        <div class="avatar placeholder mb-2">
                            <div class="bg-neutral text-neutral-content rounded-full w-20 ring ring-primary ring-offset-base-100 ring-offset-2">
                                {{if $c.AvatarBase64}}
                                    <img src="data:image/jpeg;base64,{{$c.AvatarBase64}}" />
                                {{else}}
                                    <span class="text-2xl font-bold">{{slice $c.FullName 0 1}}</span>
                                {{end}}
                            </div>
                        </div> 
                        
                        <h2 class="card-title text-2xl font-black tracking-tight">{{$c.FullName}}</h2>
                        <p class="text-[10px] opacity-40 uppercase tracking-widest font-bold">Standardize Phone Number</p>
                        
                        <div class="divider my-1 opacity-20"></div>

                        <div class="w-full py-2 space-y-3">
                            <div class="bg-base-200 rounded-xl p-3 border border-base-300/50">
                                <span class="text-[10px] uppercase opacity-40 block mb-1 font-bold">Current</span>
                                <span class="font-mono text-sm opacity-70">{{$p.Phone}}</span>
                            </div>
                            
                            <div class="bg-primary/5 rounded-xl p-3 border border-primary/20 relative overflow-hidden">
                                <span class="text-[10px] uppercase text-primary font-black block mb-1">Preview</span>
                                <span class="preview-text font-mono text-xl font-bold text-primary tracking-widest leading-none">--</span>
                            </div>
                        </div>

                        <div class="card-actions w-full flex-col gap-4 mt-4">
                            <button onclick="applyFormat(event, '{{$c.ID}}', '{{$p.ID}}')" 
                                    class="btn btn-primary btn-block shadow-lg">
                                Apply Format
                            </button>
                            
                            <button onclick="UtilCommon.showNext(this.closest('.util-card'))" 
                                    class="btn btn-ghost btn-sm opacity-50 hover:opacity-100 font-bold uppercase tracking-tighter mx-auto">
                                Skip Contact
                            </button>
                        </div>
                    </div>
                </div>
                {{end}}
            {{end}}
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    if (window.previewPhone) window.previewPhone();
                });
            </script>
        {{else}}
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    if (window.UtilCommon) UtilCommon.showFinishedState();
                });
            </script>
        {{end}}
    </div>

    <div class="side-action-btn hidden md:block w-24"></div>
{{end}}

{{define "scripts"}}
<script src="/static/js/util-common.js"></script>
<script src="/static/js/util-phone-format.js"></script>
{{end}}